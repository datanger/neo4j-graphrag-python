MATLAB 中脚本（Script）、函数（Function）和变量作用域** 的完整总结与梳理，帮助你清晰理解 MATLAB 的代码结构、调用方式和变量可见性规则。

## 📚 一、MATLAB 中的代码类型

| 类型 | 是否有输入/输出参数 | 变量作用域 | 能否被其他文件调用 |
|------|------------------|------------|--------------------|
| **脚本（Script）** | ❌ 没有 | 基础工作区（Base Workspace） | ✅ 可以直接调用另一个脚本 |
| **主函数（Main Function）** | ✅ 有 | 局部工作区（Local Workspace） | ✅ 可以被其他脚本或函数调用 |
| **本地函数（Local Function）** | ✅ 有 | 局部作用域（仅当前 `.m` 文件可用） | ❌ 不能被外部文件直接调用 |
| **嵌套函数（Nested Function）** | ✅ 有 | 嵌套作用域（可访问父函数变量） | ❌ 仅能被父函数调用 |
| **私有函数（Private Function）** | ✅ 有 | 局部作用域 | ✅ 仅对特定目录下的函数可见 |

---

## 🔁 二、调用关系图解

```
脚本 <----> 函数
     ↖        ↗
      ↘     ↙
       Local Functions
         ↑
     Nested Functions
```

- 脚本可以调用函数；
- 函数之间可以相互调用；
- 本地函数只能在同一个 `.m` 文件中被主函数调用；
- 嵌套函数只能被其父函数调用；
- 私有函数只能被特定路径下的函数调用。

---

## 🧱 三、变量作用域详解

### 1. **基础工作区（Base Workspace）**

- 所有在命令行窗口或脚本中定义的变量都属于这个区域。
- 在一个脚本中定义的变量，在另一个脚本中也可以使用（前提是已经运行过该脚本）。
- 易于调试但容易造成变量污染。

### 2. **局部工作区（Function Workspace）**

- 函数内部定义的变量只在函数内部可见。
- 函数之间通过输入输出参数传递数据。
- 避免了变量冲突，推荐用于大型项目。

### 3. **嵌套函数的作用域（Nested Scope）**

- 嵌套函数可以访问父函数中的变量，无需传参。
- 父函数也可以调用嵌套函数。
- 适用于需要共享变量的小模块。

### 4. **全局变量（Global Variables）**

- 使用 `global` 关键字声明。
- 可以跨脚本和函数访问。
- ⚠️ 不建议滥用，容易导致代码混乱、难以维护。

---

## 📝 四、脚本与函数调用规则总结

| 调用者 \ 被调用者 | 脚本 | 主函数 | 本地函数 | 嵌套函数 | 私有函数 |
|------------------|------|--------|----------|----------|----------|
| **脚本**         | ✅   | ✅     | ❌       | ❌       | ✅（路径允许时） |
| **主函数**       | ✅   | ✅     | ✅       | ✅       | ✅（路径允许时） |
| **本地函数**     | ✅（路径允许） | ✅     | ✅       | ✅       | ✅（路径允许时） |
| **嵌套函数**     | ✅   | ✅     | ✅       | ✅       | ✅       |

---

## 🧩 五、变量访问权限总结

| 调用者 \ 变量来源 | 基础工作区变量（脚本定义） | 局部变量（函数定义） | 全局变量 |
|------------------|----------------------------|----------------------|-----------|
| **脚本**         | ✅                         | ❌                   | ✅（需声明） |
| **函数**         | ✅                         | ✅                   | ✅（需声明） |
| **本地函数**     | ✅                         | ✅                   | ✅（需声明） |
| **嵌套函数**     | ✅                         | ✅（父函数变量）     | ✅（需声明） |

---

## 📋 六、最佳实践建议

| 场景 | 推荐做法 |
|------|----------|
| 快速测试、小任务 | 使用脚本 |
| 复杂逻辑、复用性强 | 使用函数 |
| 需要多个函数配合 | 同一 `.m` 文件写主函数 + 本地函数 |
| 需要共享变量 | 使用函数参数传值，或 `.mat` 文件保存加载 |
| 大型项目开发 | 尽量避免使用脚本，全部封装为函数 |
| 需要模块化管理 | 使用私有函数、子函数、包（Package） |
| 需要快速调试 | 结合脚本调用函数的方式 |
| 需要避免变量污染 | 使用函数封装变量，避免全局变量 |

---

## 📎 七、补充说明：R2016b 及以后版本的变化

从 R2016b 开始：

- 支持在一个 `.m` 文件中写多个本地函数；
- 支持将脚本与本地函数混合编写（脚本部分必须放在最前面）；
- 更加灵活地组织代码，适合小型项目快速开发。

例如：

```matlab
% myscript.m
disp('This is the script part');

% Call a local function
result = addFunc(3, 4);
disp(result);

% Local function
function out = addFunc(a, b)
    out = a + b;
end
```

---

## 📌 总结一句话：

> **MATLAB 中脚本可以直接调用另一个脚本执行并共享变量；函数之间通过参数传递数据；变量作用域决定它们是否可见。建议复杂逻辑使用函数封装，提高代码可维护性和安全性。**

